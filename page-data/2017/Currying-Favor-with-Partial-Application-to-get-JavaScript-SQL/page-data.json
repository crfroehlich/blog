{"componentChunkName":"component---src-templates-article-tsx","path":"/2017/Currying-Favor-with-Partial-Application-to-get-JavaScript-SQL","result":{"data":{"mdx":{"fields":{"id":"a3959ba1-dee5-5df7-966f-5d4625bd0770","title":"Currying Favor with Partial Application to get JavaScript SQL","slug":"/2017/Currying-Favor-with-Partial-Application-to-get-JavaScript-SQL","date":"2017-02-04T05:00:00.000Z","tags":["currying","code","partial","application"]},"frontmatter":{"background":{"childImageSharp":{"fluid":{"base64":"data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAKABQDASIAAhEBAxEB/8QAFwAAAwEAAAAAAAAAAAAAAAAAAAIEA//EABUBAQEAAAAAAAAAAAAAAAAAAAEA/9oADAMBAAIQAxAAAAGzGlycQH//xAAaEAACAgMAAAAAAAAAAAAAAAABAgAxESEy/9oACAEBAAEFAnsUnK7hAzP/xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAEDAQE/AT//xAAUEQEAAAAAAAAAAAAAAAAAAAAQ/9oACAECAQE/AT//xAAaEAADAAMBAAAAAAAAAAAAAAAAATEQESFx/9oACAEBAAY/AlKb5SD9Isf/xAAcEAACAgIDAAAAAAAAAAAAAAAAAREhMWFBUdH/2gAIAQEAAT8hvuMkJ2PTg7kbl2Immk9jxgVUqP/aAAwDAQACAAMAAAAQn/8A/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPxA//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPxA//8QAGxAAAgMBAQEAAAAAAAAAAAAAAREAITFhQaH/2gAIAQEAAT8QwEB0V2H6IKoXHy45e/AYbldYSRqBAAIIYEIuRHgqf//Z","aspectRatio":2,"src":"/static/1d3e4fe2994f9707f81083cbb9b29c2a/00d44/curry_favor.jpg","srcSet":"/static/1d3e4fe2994f9707f81083cbb9b29c2a/08a48/curry_favor.jpg 50w,\n/static/1d3e4fe2994f9707f81083cbb9b29c2a/5b365/curry_favor.jpg 100w,\n/static/1d3e4fe2994f9707f81083cbb9b29c2a/00d44/curry_favor.jpg 200w,\n/static/1d3e4fe2994f9707f81083cbb9b29c2a/2a663/curry_favor.jpg 205w","sizes":"(max-width: 200px) 100vw, 200px"}}}},"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"background\": \"../../assets/images/curry_favor.jpeg\",\n  \"date\": \"02/04/2017\",\n  \"description\": \"Editorâ€™s Note This is an old post from March of 2013 from an old blog Apparently it still gets enoug...\",\n  \"draft\": false,\n  \"tags\": [\"currying\", \"code\", \"partial\", \"application\"],\n  \"title\": \"Currying Favor with Partial Application to get JavaScript SQL\"\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Editor\\u2019s Note: This is an old post from March of 2013, from an old blog. Apparently it still gets enough hits to need updating as links have changed. Re-posting it here with URL corrections.\")), mdx(\"p\", null, \"There is a domain that attends to curry as one of the quintessential elements of regional cuisine. This is not that domain; though in this domain I would argue we need a paprika.\"), mdx(\"p\", null, \"If the terms \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"curry\"), \" or \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"partial application\"), \" are at all unfamiliar to you, I highly recommend Reg Braithwaite\\u2019s \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://raganwald.com/2013/03/07/currying-and-partial-application.html\"\n  }), \"latest opus on the subject\"), \". Lending support are \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://plus.google.com/112487099551149077731\"\n  }), \"+Ben Alman\"), \" with his own \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://benalman.com/news/2012/09/partial-application-in-javascript/\"\n  }), \"eviscerating tour de force\"), \" as well as \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://plus.google.com/110516491705475800224\"\n  }), \"+Axel Rauschmayer\"), \" with his \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://www.2ality.com/2011/09/currying-vs-part-eval.html\"\n  }), \"very, extremely, routinely reputable entry\"), \". If you\\u2019ve ever followed me here before, you may remember a fog surrounding an idea that touched on partial application from \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://hiking.luddites.me/2013/01/good-reads.html\"\n  }), \"Good Reads\"), \", where I linked to (again to Mr. Braithwaite) \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/raganwald/homoiconic/blob/master/2013/01/practical-applications-of-partial-application.md\"\n  }), \"the skinny\"), \".\"), mdx(\"p\", null, \"Do not be confused, dismayed, disheartened or discouraged. Currying and partial application are not easy-to-grok. The literature on the subject, while vast, is dense. Even in the most skilled hands, attempts to bring these tomes down from Mt. Sinai, have not routinely resulted in greater clarity.\"), mdx(\"p\", null, \"But this is not yet-another-indoctrination on the subject. Defer to the authorities above for that. Here, I\\u2019m attempting to exploit the potential for good. Using both ingredients, it is possible to create a semantic for querying JavaScript objects in a syntax that resembles SQL. Are there other solutions to do this? \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://plus.google.com/108988276571177665337/posts/ahm5G625Vix\"\n  }), \"Yes\"), \".\"), mdx(\"p\", null, \"Once you\\u2019ve apprehended grokation of the concepts, it should be straightforward to see the implementation of a few partial application standard methods: \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://en.wikipedia.org/wiki/Map_%28higher-order_function%29\"\n  }), \"map\"), \", \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://en.wikipedia.org/wiki/Filter_%28higher-order_function%29\"\n  }), \"filter\"), \" and \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://en.wikipedia.org/wiki/Fold_%28higher-order_function%29\"\n  }), \"fold\"), \". Lots of libraries have already done the diligence and written these for us but for the sake of having something to write, let\\u2019s implement them again (In the real world, you\\u2019re better off taking what \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://wiht.link/FunctionalJS\"\n  }), \"functional js\"), \" or \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://fitzgen.github.com/wu.js\"\n  }), \"wu.js\"), \" have already built)!\"), mdx(\"p\", null, \"function curryLeft(func) {\\nvar slice = Array.prototype.slice;\\nvar args = slice.call(arguments, 1);\\nreturn function() {\\nreturn func.apply(this, args.concat(slice.call(arguments, 0)));\"), mdx(\"p\", null, \"}\\n}\"), mdx(\"p\", null, \"function foldLeft(func,newArray,oldArray) {\\nvar accumulation = newArray;\\neach(oldArray, function(val) {\\naccumulation = func(accumulation, val);\\n});\\nreturn accumulation;\"), mdx(\"p\", null, \"}\"), mdx(\"p\", null, \"function map(func, array) {\\nvar onIteration = function(accumulation, val) {\\nreturn accumulation.concat(func(val));\\n};\\nreturn foldLeft(onIteration, \", \"[\", \"]\", \", array)\\n}\"), mdx(\"p\", null, \"function filter(func, array) {\\nvar onIteration = function(accumulation, val) {\\nif(func(val)) {\\nreturn accumulation.concat(val);\\n} else {\\nreturn accumulation;\\n}\\n};\\nreturn foldLeft(onIteration, \", \"[\", \"]\", \", array)\\n}\"), mdx(\"p\", null, \"With just these, we can do something that\\u2019s almost cool. We can extend the native Array class to add some new methods:\"), mdx(\"p\", null, \"Object.defineProperties(Array.prototype, {\\n\\u2019\", \"_\", \"where\\u2019: {\\nvalue: function(func) {\\nreturn filter(func, this);\\n}\\n},\\n\\u2019\", \"_\", \"select\\u2019: {\\nvalue: function(func) {\\nreturn map(func, this);\\n}\\n}\\n});\"), mdx(\"p\", null, \"At this point, given an instance of an Array (thanks to \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/marak/Faker.js/\"\n  }), \"Faker\"), \"), like:\"), mdx(\"p\", null, \"var somePeople = \", \"[\", \"\\n{\\u201CFirstName\\u201D:\\u201CCristina\\u201D, \\u201CLastName\\u201D:\\u201CQuigley\\u201D, \\u201CPhoneNumber\\u201D:\\u201C1-189-868-2830\\u201D, \\u201CEmail\\u201D:\\u201D\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"mailto:Imelda@lourdes.ca\"\n  }), \"Imelda@lourdes.ca\"), \"\\u201D, \\u201CId\\u201D:0},\\n{\\u201CFirstName\\u201D:\\u201CEriberto\\u201D, \\u201CLastName\\u201D:\\u201CBailey\\u201D, \\u201CPhoneNumber\\u201D:\\u201C1-749-549-2050 x36612\\u201D, \\u201CEmail\\u201D:\\u201CPamela\", \"_\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"mailto:Gaylord@ludie.net\"\n  }), \"Gaylord@ludie.net\"), \"\\u201D, \\u201CId\\u201D:1},\\n{\\u201CFirstName\\u201D:\\u201CAmina\\u201D, \\u201CLastName\\u201D:\\u201CSchaden\\u201D, \\u201CPhoneNumber\\u201D:\\u201C463-301-9579 x9511\\u201D, \\u201CEmail\\u201D:\\u201CConner\", \"_\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"mailto:Gusikowski@jolie.tv\"\n  }), \"Gusikowski@jolie.tv\"), \"\\u201D, \\u201CId\\u201D:2}\", \"]\", \";\"), mdx(\"p\", null, \"If we wanted to select the FirstName of each record, we could do something crude like:\"), mdx(\"p\", null, \"somePeople.\", \"_\", \"select(function(row) { return row.FirstName });\"), mdx(\"p\", null, \"But this is still too obtuse. With a little curry, we can make it better. We used partial application to get to \\u2018\", \"_\", \"select\\u2019, but we can switch gears to curry to get a better query mechanism. First, let\\u2019s define a query method: \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Update: we technically don\\u2019t need curry here, as we\\u2019re not abstracting the \\u2018query\\u2019 object as a parameter. Thanks to Thomas Burette in the comments\"), \".\"), mdx(\"p\", null, \"var query = function(array) {\\nvar tables = \", \"[\", \"]\", \";\\ntables.push(array);\\nvar \", \"_\", \"query = {\\ntables: tables,\\nfrom: from,\\nselect: select,\\nrun: run\\n};\\nreturn \", \"_\", \"query;\\n};\"), mdx(\"p\", null, \"select and from methods are straightforward:\"), mdx(\"p\", null, \"function select() {\\nvar query = this;\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"text\"\n  }, mdx(\"pre\", _extends({\n    parentName: \"div\"\n  }, {\n    \"className\": \"language-text\"\n  }), mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-text\"\n  }), \"var slice = Array.prototype.slice;\\nvar args = slice.call(arguments, 0);\\nquery.columns = query.columns || \\\\[\\\\];\\neach(args, function(argumentValue) {\\n    query.columns.push(argumentValue);\\n});\\nreturn query;\"))), mdx(\"p\", null, \"}\"), mdx(\"p\", null, \"function from(array) {\\nvar query = this;\\nquery.tables.push(array);\\nreturn query;\\n}\"), mdx(\"p\", null, \"which then only leaves execution. I\\u2019ve deliberately not optimized this method for the purpose of illustration: in the absence of the tools, this is what such code looks like. Look at the redundancy and duplication. Marvel at the inelegance. \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"http://prog21.dadgum.com/169.html\"\n  }), \"Appreciate the fact that it works\"), \".\"), mdx(\"p\", null, \"function run() {\\nvar query = this;\\nvar ret = \", \"[\", \"]\", \";\\nif (query.columns.length > 0) {\\nvar results = \", \"[\", \"]\", \";\\neach(query.columns, function(columnName) {\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"text\"\n  }, mdx(\"pre\", _extends({\n    parentName: \"div\"\n  }, {\n    \"className\": \"language-text\"\n  }), mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-text\"\n  }), \"        each(query.tables, function(tbl) {\\n            if (Array.isArray(tbl)) {\\n                var res = {};\\n                var val = tbl.\\\\_select(function(val) {\\n                    return val\\\\[columnName\\\\];\\n                });\\n                if (val) {\\n                    res\\\\[columnName\\\\] = val;\\n                    results.push(res);\\n                }\\n            }\\n        }, true);\\n\\n    });\\n\\n    var returnRows = \\\\[\\\\];\\n    if(results && results.length > 0) {\\n        var firstResult = results\\\\[0\\\\];\\n\\n        each(firstResult, function(val, key) {\\n\\n            each(val, function(cell){\\n                var row = {};\\n                row\\\\[key\\\\] = cell;\\n                each(results.slice(1), function(result) {\\n                    each(result, function(v,k){\\n                        each(v, function(c) {\\n                            row\\\\[k\\\\] = c;\\n                        })\\n                    },true)\\n                },true)\\n                returnRows.push(row);\\n            },true);\\n\\n        },true)\\n\\n    }\\n\\n}\\nreturn returnRows;\"))), mdx(\"p\", null, \"}\"), mdx(\"p\", null, \"Now, this yields a syntax which looks a lot more like SQL:\"), mdx(\"p\", null, \"var newQuery = query(people).select(\\u2018FirstName\\u2019, \\u2018LastName\\u2019);\\nvar results = newQuery.run();\"), mdx(\"p\", null, \"From here, \\u2018where\\u2019, \\u2018join\\u2019 (yes I said JOIN), \\u2018orderby\\u2019 and \\u2018groupby\\u2019 are all implementation details. This is just a proof-of-concept post, but given some large Faker data sets it already works quite well given its limitations. Refactoring \\u2018run\\u2019 into a method which utilizes partial application will yield mountains.\"), mdx(\"p\", null, \"As always, everything I blog and code is public domain. You can view the source from the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/somecallmechief/oj-sql\"\n  }), \"oj-sql project here\"), \", collab with me on \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://c9.io/somecallmechief/oj-sql\"\n  }), \"c9 here\"), \", or do whatever strikes your whim. May the wind that strikes your whim be always at your back.\"));\n}\n;\nMDXContent.isMDXComponent = true;"}},"pageContext":{"id":"a3959ba1-dee5-5df7-966f-5d4625bd0770","slug":"/2017/Currying-Favor-with-Partial-Application-to-get-JavaScript-SQL","previous":{"fields":{"id":"b76bbeec-72c6-5efc-8986-96bef6fc8ef6","title":"How to Lose an Employee in 10 Seconds or Less","slug":"/2017/How-to-Lose-an-Employee-in-10-Seconds-or-Less","date":"2017-01-16T05:00:00.000Z","tags":["management","leadership","hiring","work"]},"tableOfContents":{},"parent":{"relativePath":"2017/How-to-Lose-an-Employee-in-10-Seconds-or-Less.md"},"frontmatter":{"title":"How to Lose an Employee in 10 Seconds or Less","subtitle":null,"date":"01/16/2017","tags":["management","leadership","hiring","work"]}},"next":{"fields":{"id":"8bb299b1-80aa-5ba1-809c-5df3100ac5bb","title":"Code Generation: There and Back Again","slug":"/2017/Code-Generation--There-and-Back-Again","date":"2017-10-24T04:00:00.000Z","tags":["metadata","retrospective","code","generation"]},"tableOfContents":{},"parent":{"relativePath":"2017/Code-Generation--There-and-Back-Again.md"},"frontmatter":{"title":"Code Generation: There and Back Again","subtitle":" There and Back Again","date":"10/24/2017","tags":["metadata","retrospective","code","generation"]}},"pageTags":[{"name":"currying","count":1},{"name":"code","count":21},{"name":"partial","count":1},{"name":"application","count":1}],"toc":{"type":"Article"},"title":"Currying Favor with Partial Application to get JavaScript SQL","type":"Article"}},"staticQueryHashes":["359992727"]}