<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta property="twitter:card" content="summary_large_image"/><link rel="shortcut icon" type="image/svg" href="/favicon.svg"/><noscript></noscript><style data-href="/styles.e778714182680d03d7ef.css">pre[class*=language-].line-numbers{position:relative;padding-left:3.8em;counter-reset:linenumber}pre[class*=language-].line-numbers>code{position:relative;white-space:inherit}.line-numbers .line-numbers-rows{position:absolute;pointer-events:none;top:0;font-size:100%;left:-3.8em;width:3em;letter-spacing:-1px;border-right:1px solid #999;-webkit-user-select:none;-ms-user-select:none;user-select:none}.line-numbers-rows>span{display:block;counter-increment:linenumber}.line-numbers-rows>span:before{content:counter(linenumber);color:#999;display:block;padding-right:.8em;text-align:right}.command-line-prompt{border-right:1px solid #999;display:block;float:left;font-size:100%;letter-spacing:-1px;margin-right:1em;pointer-events:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.command-line-prompt>span:before{color:#999;content:" ";display:block;padding-right:.8em}.command-line-prompt>span[data-user]:before{content:"[" attr(data-user) "@" attr(data-host) "] $"}.command-line-prompt>span[data-user=root]:before{content:"[" attr(data-user) "@" attr(data-host) "] #"}.command-line-prompt>span[data-prompt]:before{content:attr(data-prompt)}@keyframes swing{0%,30%,50%,70%,to{transform:rotate(0deg)}10%{transform:rotate(10deg)}40%{transform:rotate(-10deg)}60%{transform:rotate(5deg)}80%{transform:rotate(-5deg)}}.pro-sidebar{color:#fff;height:100%;width:300px;min-width:300px;text-align:left;transition:width,left,right,.3s;position:relative;z-index:1009}.pro-sidebar>.pro-sidebar-inner{background:#001933;height:100%;position:relative;z-index:101}.pro-sidebar>.pro-sidebar-inner>img.sidebar-bg{width:100%;height:100%;-o-object-fit:cover;object-fit:cover;-o-object-position:center;object-position:center;position:absolute;opacity:.3;left:0;top:0;z-index:100}.pro-sidebar>.pro-sidebar-inner>.pro-sidebar-layout{height:100%;overflow-y:auto;overflow-x:hidden;position:relative;display:flex;flex-direction:column;z-index:101}.pro-sidebar>.pro-sidebar-inner>.pro-sidebar-layout .pro-sidebar-header{border-bottom:1px solid hsla(0,0%,100%,.2)}.pro-sidebar>.pro-sidebar-inner>.pro-sidebar-layout .pro-sidebar-content{flex-grow:1}.pro-sidebar>.pro-sidebar-inner>.pro-sidebar-layout .pro-sidebar-footer{border-top:1px solid hsla(0,0%,100%,.2)}.pro-sidebar>.pro-sidebar-inner>.pro-sidebar-layout ul{list-style-type:none;padding:0;margin:0}.pro-sidebar .overlay{position:fixed;top:0;right:0;bottom:0;left:0;background-color:rgba(0,0,0,.3);z-index:100;display:none}.pro-sidebar.collapsed{width:80px;min-width:80px}.pro-sidebar.rtl{text-align:right;direction:rtl}@media (max-width:480px){.pro-sidebar.xs{position:fixed;left:-300px}.pro-sidebar.xs.collapsed{left:-80px}.pro-sidebar.xs.toggled{left:0}.pro-sidebar.xs.toggled .overlay{display:block}.pro-sidebar.xs.rtl{left:auto;right:-300px}.pro-sidebar.xs.rtl.collapsed{left:auto;right:-80px}.pro-sidebar.xs.rtl.toggled{left:auto;right:0}}@media (max-width:576px){.pro-sidebar.sm{position:fixed;left:-300px}.pro-sidebar.sm.collapsed{left:-80px}.pro-sidebar.sm.toggled{left:0}.pro-sidebar.sm.toggled .overlay{display:block}.pro-sidebar.sm.rtl{left:auto;right:-300px}.pro-sidebar.sm.rtl.collapsed{left:auto;right:-80px}.pro-sidebar.sm.rtl.toggled{left:auto;right:0}}@media (max-width:768px){.pro-sidebar.md{position:fixed;left:-300px}.pro-sidebar.md.collapsed{left:-80px}.pro-sidebar.md.toggled{left:0}.pro-sidebar.md.toggled .overlay{display:block}.pro-sidebar.md.rtl{left:auto;right:-300px}.pro-sidebar.md.rtl.collapsed{left:auto;right:-80px}.pro-sidebar.md.rtl.toggled{left:auto;right:0}}@media (max-width:992px){.pro-sidebar.lg{position:fixed;left:-300px}.pro-sidebar.lg.collapsed{left:-80px}.pro-sidebar.lg.toggled{left:0}.pro-sidebar.lg.toggled .overlay{display:block}.pro-sidebar.lg.rtl{left:auto;right:-300px}.pro-sidebar.lg.rtl.collapsed{left:auto;right:-80px}.pro-sidebar.lg.rtl.toggled{left:auto;right:0}}@media (max-width:1200px){.pro-sidebar.xl{position:fixed;left:-300px}.pro-sidebar.xl.collapsed{left:-80px}.pro-sidebar.xl.toggled{left:0}.pro-sidebar.xl.toggled .overlay{display:block}.pro-sidebar.xl.rtl{left:auto;right:-300px}.pro-sidebar.xl.rtl.collapsed{left:auto;right:-80px}.pro-sidebar.xl.rtl.toggled{left:auto;right:0}}.pro-sidebar .pro-menu .pro-menu-item.pro-sub-menu .pro-inner-list-item .pro-inner-item:before{display:inline-block;width:4px;min-width:4px;height:4px;border:1px solid #001933;border-radius:50%;margin-right:15px;position:relative;box-shadow:1px 0 0 #fff,0 -1px 0 #fff,0 1px 0 #fff,-1px 0 0 #fff}.pro-sidebar .pro-menu .pro-menu-item>.pro-inner-item>.pro-item-content{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.pro-sidebar .pro-menu{padding-top:10px;padding-bottom:10px}.pro-sidebar .pro-menu>ul>.pro-sub-menu>.pro-inner-list-item{position:relative;background-color:#001933}.pro-sidebar .pro-menu>ul>.pro-sub-menu>.pro-inner-list-item>div>ul{padding-top:15px;padding-bottom:15px}.pro-sidebar .pro-menu a{text-decoration:none;color:#fff}.pro-sidebar .pro-menu a:before{content:"";position:absolute;top:0;right:0;bottom:0;left:0;background-color:transparent}.pro-sidebar .pro-menu a:hover{color:orange}.pro-sidebar .pro-menu .pro-menu-item{font-size:15px}.pro-sidebar .pro-menu .pro-menu-item.active{color:orange}.pro-sidebar .pro-menu .pro-menu-item .suffix-wrapper{opacity:1;transition:opacity .2s}.pro-sidebar .pro-menu .pro-menu-item .prefix-wrapper{display:flex;margin-right:5px;opacity:1;transition:opacity .2s}.pro-sidebar .pro-menu .pro-menu-item>.pro-inner-item{position:relative;display:flex;align-items:center;padding:8px 35px 8px 20px;cursor:pointer}.pro-sidebar .pro-menu .pro-menu-item>.pro-inner-item:focus{outline:none;color:orange}.pro-sidebar .pro-menu .pro-menu-item>.pro-inner-item>.pro-icon-wrapper{margin-right:10px;font-size:14px;width:20px;min-width:20px;height:20px;line-height:20px;text-align:center;display:inline-block}.pro-sidebar .pro-menu .pro-menu-item>.pro-inner-item>.pro-icon-wrapper .pro-icon{display:flex;height:100%;align-items:center;justify-content:center;padding-right:10px}.pro-sidebar .pro-menu .pro-menu-item>.pro-inner-item>.pro-item-content{flex-grow:1;flex-shrink:1}.pro-sidebar .pro-menu .pro-menu-item>.pro-inner-item:hover{color:orange}.pro-sidebar .pro-menu .pro-menu-item>.pro-inner-item:hover .pro-icon-wrapper .pro-icon{animation:swing .5s ease-in-out 1 alternate}.pro-sidebar .pro-menu .pro-menu-item.pro-sub-menu>.pro-inner-item:before{background:#fff}.pro-sidebar .pro-menu .pro-menu-item.pro-sub-menu>.pro-inner-item>.pro-arrow-wrapper{position:absolute;right:20px;top:50%;transform:translateY(-50%)}.pro-sidebar .pro-menu .pro-menu-item.pro-sub-menu>.pro-inner-item>.pro-arrow-wrapper .pro-arrow{display:inline-block;border-color:#fff;border-style:solid;border-width:0 2px 2px 0;padding:2.5px;vertical-align:middle;transition:transform .3s;transform:rotate(-45deg)}.pro-sidebar .pro-menu .pro-menu-item.pro-sub-menu.open>.pro-inner-item:before{background:transparent!important}.pro-sidebar .pro-menu .pro-menu-item.pro-sub-menu.open>.pro-inner-item>.pro-arrow-wrapper .pro-arrow{transform:rotate(45deg)}.pro-sidebar .pro-menu .pro-menu-item.pro-sub-menu .pro-inner-list-item{padding-left:20px}.pro-sidebar .pro-menu .pro-menu-item.pro-sub-menu .pro-inner-list-item .pro-inner-item{padding:8px 30px 8px 15px}.pro-sidebar .pro-menu.shaped .pro-menu-item>.pro-inner-item>.pro-icon-wrapper{background-color:#001933}.pro-sidebar .pro-menu.square .pro-menu-item>.pro-inner-item>.pro-icon-wrapper{border-radius:0}.pro-sidebar .pro-menu.round .pro-menu-item>.pro-inner-item>.pro-icon-wrapper{border-radius:4px}.pro-sidebar .pro-menu.circle .pro-menu-item>.pro-inner-item>.pro-icon-wrapper{border-radius:50%}.pro-sidebar.collapsed .pro-menu>ul>.pro-menu-item{position:relative}.pro-sidebar.collapsed .pro-menu>ul>.pro-menu-item>.pro-inner-item>.prefix-wrapper,.pro-sidebar.collapsed .pro-menu>ul>.pro-menu-item>.pro-inner-item>.suffix-wrapper{opacity:0}.pro-sidebar.collapsed .pro-menu>ul>.pro-menu-item>.pro-inner-list-item{background-color:#2b2b2b;z-index:111}.pro-sidebar.collapsed .pro-menu>ul>.pro-menu-item:before{content:"";display:inline-block;position:absolute;top:0;bottom:0;left:0;right:0;cursor:pointer}.pro-sidebar.collapsed .pro-menu>ul>.pro-menu-item.pro-sub-menu{position:relative}.pro-sidebar.collapsed .pro-menu>ul>.pro-menu-item.pro-sub-menu>.pro-inner-item{pointer-events:none}.pro-sidebar.collapsed .pro-menu>ul>.pro-menu-item.pro-sub-menu>.pro-inner-item>.pro-arrow-wrapper{display:none}.pro-sidebar.collapsed .pro-menu>ul>.pro-menu-item.pro-sub-menu>.pro-inner-list-item{height:auto!important;position:fixed;visibility:hidden;min-width:220px;max-width:270px;background-color:transparent;max-height:100%;padding-left:3px}.pro-sidebar.collapsed .pro-menu>ul>.pro-menu-item.pro-sub-menu>.pro-inner-list-item.has-arrow{padding-left:10px}.pro-sidebar.collapsed .pro-menu>ul>.pro-menu-item.pro-sub-menu>.pro-inner-list-item>.popper-inner{max-height:100vh;overflow-y:auto;background-color:#2b2b2b;padding-left:20px;border-radius:4px}.pro-sidebar.collapsed .pro-menu>ul>.pro-menu-item.pro-sub-menu:hover>.pro-inner-list-item{transition:visibility,transform .3s;visibility:visible}.pro-sidebar.collapsed .pro-menu>ul>.pro-menu-item.pro-sub-menu:hover .pro-icon-wrapper .pro-icon{animation:swing .5s ease-in-out 1 alternate}.pro-sidebar.collapsed .pro-menu>ul>.pro-menu-item.pro-sub-menu .pro-inner-list-item .pro-inner-item,.pro-sidebar.collapsed .pro-menu>ul>.pro-menu-item.pro-sub-menu .pro-inner-list-item .pro-sub-menu-item{padding:8px 30px 8px 5px}.pro-sidebar.rtl .pro-menu .pro-menu-item .prefix-wrapper{margin-right:0;margin-left:5px}.pro-sidebar.rtl .pro-menu .pro-menu-item>.pro-inner-item{padding:8px 20px 8px 35px}.pro-sidebar.rtl .pro-menu .pro-menu-item>.pro-inner-item>.pro-icon-wrapper{margin-right:0;margin-left:10px}.pro-sidebar.rtl .pro-menu .pro-menu-item.pro-sub-menu>.pro-inner-item>.pro-arrow-wrapper{right:auto;left:20px}.pro-sidebar.rtl .pro-menu .pro-menu-item.pro-sub-menu>.pro-inner-item>.pro-arrow-wrapper .pro-arrow{transform:rotate(135deg)}.pro-sidebar.rtl .pro-menu .pro-menu-item.pro-sub-menu.open>.pro-inner-item>.pro-arrow-wrapper .pro-arrow{transform:rotate(45deg)}.pro-sidebar.rtl .pro-menu .pro-menu-item.pro-sub-menu .pro-inner-list-item{padding-left:0;padding-right:20px}.pro-sidebar.rtl .pro-menu .pro-menu-item.pro-sub-menu .pro-inner-list-item .pro-inner-item{padding:8px 15px 8px 30px}.pro-sidebar.rtl .pro-menu .pro-menu-item.pro-sub-menu .pro-inner-list-item .pro-inner-item:before{margin-right:0;margin-left:15px}.pro-sidebar.rtl.collapsed .pro-menu>ul>.pro-menu-item.pro-sub-menu>.pro-inner-list-item{padding-left:0;padding-right:3px}.pro-sidebar.rtl.collapsed .pro-menu>ul>.pro-menu-item.pro-sub-menu>.pro-inner-list-item.has-arrow{padding-right:10px}.pro-sidebar.rtl.collapsed .pro-menu>ul>.pro-menu-item.pro-sub-menu>.pro-inner-list-item>.popper-inner{padding-left:0;padding-right:20px}.pro-sidebar.rtl.collapsed .pro-menu>ul>.pro-menu-item.pro-sub-menu .pro-inner-list-item .pro-inner-item,.pro-sidebar.rtl.collapsed .pro-menu>ul>.pro-menu-item.pro-sub-menu .pro-inner-list-item .pro-sub-menu-item{padding:8px 5px 8px 30px}.popper-arrow{position:absolute;z-index:-1;width:0;height:0;border-top:7px solid transparent;border-bottom:7px solid transparent}.popper-element[data-popper-placement^=left]>.popper-arrow{right:0;border-right:7px solid #2b2b2b}.popper-element[data-popper-placement^=right]>.popper-arrow{left:0;border-left:7px solid #2b2b2b}.react-slidedown{height:0;transition-property:none;transition-duration:.2s;transition-timing-function:ease-in-out}.react-slidedown.transitioning{overflow-y:hidden}.react-slidedown.closed{display:none}</style><meta name="generator" content="Gatsby 2.26.1"/><title data-react-helmet="true"></title><link rel="sitemap" type="application/xml" href="/sitemap.xml"/><link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Poppins:300,400,500,600" rel="stylesheet"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-WZTYEG3VZJ"></script><script>
    window.GATSBY_GTAG_PLUGIN_GA_TRACKING_ID = (
      'G-WZTYEG3VZJ'
    );
    window.GATSBY_GTAG_PLUGIN_ANONYMIZE = false;

    var options = {
      send_page_view: false
    };
    if (false) {
      options.anonymize_ip = true;
    }

    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    window.gtag = gtag;
    gtag('js', new Date());
    gtag('config', 'G-WZTYEG3VZJ', options);
  </script><link rel="icon" href="/favicon.svg" type="image/svg+xml"/><link rel="icon" href="/favicon-32x32.png" type="image/png"/><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"/><meta name="theme-color" content="#6b37bf"/><link rel="apple-touch-icon" sizes="48x48" href="/icons/icon-48x48.png"/><link rel="apple-touch-icon" sizes="72x72" href="/icons/icon-72x72.png"/><link rel="apple-touch-icon" sizes="96x96" href="/icons/icon-96x96.png"/><link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png"/><link rel="apple-touch-icon" sizes="192x192" href="/icons/icon-192x192.png"/><link rel="apple-touch-icon" sizes="256x256" href="/icons/icon-256x256.png"/><link rel="apple-touch-icon" sizes="384x384" href="/icons/icon-384x384.png"/><link rel="apple-touch-icon" sizes="512x512" href="/icons/icon-512x512.png"/><link rel="alternate" type="application/rss+xml" title="Hiking My Desk RSS Feed" href="/rss.xml"/><link as="script" rel="preload" href="/webpack-runtime-4ac74d59a0ad025bf0f4.js"/><link as="script" rel="preload" href="/styles-31f023f48facb69035d3.js"/><link as="script" rel="preload" href="/framework-6eeb8ad043160a79d5e7.js"/><link as="script" rel="preload" href="/a9a7754c-8f76031e99554fb9676e.js"/><link as="script" rel="preload" href="/958b4c57-de047c1242e11b7f8058.js"/><link as="script" rel="preload" href="/c943faba-8cfcfdbf099e99c933af.js"/><link as="script" rel="preload" href="/af13d906-bea834845607db013d0c.js"/><link as="script" rel="preload" href="/ec1189df-52caf2ebf9f054842623.js"/><link as="script" rel="preload" href="/5cb6ece7-82975cb71936d667e479.js"/><link as="script" rel="preload" href="/app-e6a5d6e68faad991f6c2.js"/><link as="fetch" rel="preload" href="/page-data/2013/a-promise-to-indexeddb/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/sq/d/359992727.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/page-data/app-data.json" crossorigin="anonymous"/><script defer="">
                !function(t,e){var o,n,p,r;e.__SV||(window.posthog=e,e._i=[],e.init=function(i,s,a){function g(t,e){var o=e.split(".");2==o.length&&(t=t[o[0]],e=o[1]),t[e]=function(){t.push([e].concat(Array.prototype.slice.call(arguments,0)))}}(p=t.createElement("script")).type="text/javascript",p.async=!0,p.src=s.api_host+"/static/array.js",(r=t.getElementsByTagName("script")[0]).parentNode.insertBefore(p,r);var u=e;for(void 0!==a?u=e[a]=[]:a="posthog",u.people=u.people||[],u.toString=function(t){var e="posthog";return"posthog"!==a&&(e+="."+a),t||(e+=" (stub)"),e},u.people.toString=function(){return u.toString(1)+".people (stub)"},o="capture identify alias people.set people.set_once set_config register register_once unregister opt_out_capturing has_opted_out_capturing opt_in_capturing reset isFeatureEnabled onFeatureFlags".split(" "),n=0;n<o.length;n++)g(u,o[n]);e._i.push([i,s,a])},e.__SV=1)}(document,window.posthog||[]);
                posthog.init('ElS-IXugUjsuVNO8Afdc7kWBVXhBGrxlRqWRfoliiTU',{api_host:'https://luddites-posthog.herokuapp.com'})
            </script></head><body><script>
void function() {
  window.__onThemeChange = function() {}

  var preferredTheme
  try {
    preferredTheme = localStorage.getItem('theme')
  } catch (err) { }

  function setTheme(newTheme) {
    if (preferredTheme && document.body.classList.contains(preferredTheme)) {
      document.body.classList.replace(preferredTheme, newTheme)
    } else {
      document.body.classList.add(newTheme)
    }

    window.__theme = newTheme
    preferredTheme = newTheme
    window.__onThemeChange(newTheme)
  }

  window.__setPreferredTheme = function(newTheme) {
    setTheme(newTheme)
    try {
      localStorage.setItem('theme', newTheme)
    } catch (err) {}
  }

  var darkQuery = window.matchMedia('(prefers-color-scheme: dark)')
  darkQuery.addListener(function(e) {
    window.__setPreferredTheme(e.matches ? 'dark' : 'light')
  })

  setTheme(preferredTheme || (darkQuery.matches ? 'dark' : 'light'))
}()
    </script><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div><div class="titleWrapper"><style data-emotion-css="z8r0de">.css-z8r0de{font-size:32px;line-height:1.5;font-weight:500;border-left:2px solid #1ed3c6;padding:0 16px;-webkit-flex:1;-ms-flex:1;flex:1;margin-top:0;padding-top:0;}</style><h1 class="css-z8r0de eutwdrm0">A Promise to IndexedDb</h1><style data-emotion-css="1tz1kkv">.css-1tz1kkv{padding:1rem 1.5rem;text-align:right;}.css-1tz1kkv a{font-size:14px;font-weight:500;line-height:1em;-webkit-text-decoration:none;text-decoration:none;color:#555;border:1px solid rgb(211,220,228);cursor:pointer;border-radius:3px;-webkit-transition:all 0.2s ease-out 0s;transition:all 0.2s ease-out 0s;-webkit-text-decoration:none;text-decoration:none;color:rgb(36,42,49);background-color:rgb(255,255,255);height:30px;padding:5px 16px;}.css-1tz1kkv a:hover{background-color:rgb(245,247,249);}</style><div class="mobileView css-1tz1kkv eutwdrm1"><a href="https://github.com/crfroehlich/blog/tree/main/content/undefined" class="gitBtn"><svg aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" class="svg-inline--fa fa-github fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg><div style="padding-left:5px">Source</div></a></div></div><style data-emotion-css="daoj4t">.css-daoj4t{max-width:750px;}.css-daoj4t ul,.css-daoj4t ol{-webkit-padding-start:40px;-moz-padding-start:40px;-o-padding-start:40px;margin:24px 0px;padding:0px 0px 0px 2em;}.css-daoj4t ul li,.css-daoj4t ol li{font-size:16px;line-height:1.8;font-weight:400;}.css-daoj4t a{-webkit-transition:color 0.15s;transition:color 0.15s;}.css-daoj4t code{border-radius:10px;}@media (max-width:767px){.css-daoj4t{padding:0 15px;}}</style><div class="css-daoj4t eutwdrm2"><div class="jss1"><a style="margin-right:0.5rem" href="/тег/promises"><span class="MuiBadge-root" style="right:-0.3rem;top:-0.3rem"><div class="MuiButtonBase-root MuiChip-root MuiChip-clickable" tabindex="0" role="button" style="background-color:#1ed3c6;color:fff"><span class="MuiChip-label">promises</span></div><span class="MuiBadge-badge MuiBadge-anchorOriginTopRightRectangle MuiBadge-colorPrimary">2</span></span></a><a style="margin-right:0.5rem" href="/тег/code"><span class="MuiBadge-root" style="right:-0.3rem;top:-0.3rem"><div class="MuiButtonBase-root MuiChip-root MuiChip-clickable" tabindex="0" role="button" style="background-color:#1ed3c6;color:fff"><span class="MuiChip-label">code</span></div><span class="MuiBadge-badge MuiBadge-anchorOriginTopRightRectangle MuiBadge-colorPrimary">21</span></span></a><a style="margin-right:0.5rem" href="/тег/persistence"><span class="MuiBadge-root" style="right:-0.3rem;top:-0.3rem"><div class="MuiButtonBase-root MuiChip-root MuiChip-clickable" tabindex="0" role="button" style="background-color:#1ed3c6;color:fff"><span class="MuiChip-label">persistence</span></div><span class="MuiBadge-badge MuiBadge-anchorOriginTopRightRectangle MuiBadge-colorPrimary">2</span></span></a><span style="color:#1ed3c6" class="blogDate">среда, 26.06.2013 г.</span></div><p>Quite a bit of my free time in the last 8 months has slipped away into <a href="http://somecallmechief.github.io/oj/">OJ</a>, my solution to the hell of dynamic form creation (based on arbitrary data inputs and accordingly arbitrary data outputs). Folks at <a href="http://www.wufoo.com/">WuFoo</a> and <a href="https://bootsnipp.com/index.php/forms">Bootsnip</a> have some nice prototypes of runtime manipulatable engines; while each looks like excellent work, neither solves my problem of generating entire workflows based on data. I want the data to drive the UI; the UI should simply read the data and generate the necessary rich form content necessary to provide slick, intuitive, addictive user experiences.</p><p>In the pursuit of this heffalump, I had recently been working on decomposing <a href="http://www.youtube.com/user/karnevalCom">Martin Orth</a>’s <a href="http://www.youtube.com/watch?v=QJwlEry_ER4">query builder</a> into classes in the OJ framework (see it on <a href="https://github.com/somecallmechief/oj">Github</a>, in <a href="https://npmjs.org/package/ojs">NPM</a>, and collaborate with me in <a href="https://c9.io/somecallmechief/oj">Cloud9</a>). This body of work depends upon <a href="http://www.sencha.com/products/extjs">ExtJs</a>, which is a powerful but extraordinarily inscrutable framework. I spend a frustrating amount of time comparing the inputs into Ext from OJ vs the inputs in Sencha’s examples or their documentation. It’s tedious and fragile as seeming minor changes can produce difficult to track bugs which go unobserved across several commits.</p><p>I wanted to be able to instrument my code in such a way that I could flip a switch and start logging every input into Ext. I had a few requirements: the objects logged needed to be in as close a state as possible to their values at the time of logging (logging to the console sends the object by reference, so you’ll usually get the last known value of the object by the time you see it). The objects needed to persist across page loads. There would be a lot of data (more than would fit in localStorage). Finally, the data needed to be queryable.</p><p><a href="https://developer.mozilla.org/en-US/docs/IndexedDB%E2%80%8E">IndexedDb</a> seemed like a potentially good fit. Unfortunately, like so many “HTML5” standards, <a href="https://developer.mozilla.org/en-US/docs/IndexedDB">the API is terrible</a>. If the consumers of this API were just vendors, like Chrome and Firefox, it would be hard to identify any specific contract as “wrong”; but as a developer consuming this API, I cannot easily point to any component and say, “this is right.” But it is what it is, and it is all we’ve got.</p><p>So in an effort to transmogrify the indexedDb API into something that I would actually want to use myself, I put together a proof-of-concept wrapped around <a href="http://wiki.commonjs.org/wiki/Promises/A">Promises</a>. I am developing it inside of OJ, but it could easily be factored out to use independently.</p><p>You’ll need:</p><ul><li><a href="https://github.com/kriskowal/q">Q.js</a> (<a href="http://www.blogger.com/profile/01443956999129365941">Kris Kowal</a>’s excellent Promise library)</li><li>The <a href="http://nparashuram.com/IndexedDBShim/">IndexedDb polyfill</a> (to support the IEs of the world, and such)</li><li><a href="https://github.com/marak/Faker.js/%E2%80%8E">FakerJs</a> (Optional: very useful to get prototypes running without worrying about creating the data)</li><li><a href="http://somecallmechief.github.io/oj/">OJ</a> (Optional: only if you don’t want to have to factor out my helper methods)</li></ul><p>This is the API that I wanted to call:</p><div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> tableName <span class="token operator">=</span> <span class="token string">&#x27;messages&#x27;</span><span class="token punctuation">,</span>
  dbName <span class="token operator">=</span> <span class="token string">&#x27;diagnostics&#x27;</span><span class="token punctuation">,</span>
  dbVersion <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment">//Create a new DB manager instance</span>
<span class="token keyword">var</span> newDbMgr <span class="token operator">=</span> <span class="token function">initDb</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//Connect to a specific database</span>
newDbMgr<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>dbName<span class="token punctuation">,</span> dbVersion<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//Create or extend a schema</span>
<span class="token comment">//newDbMgr.ddl.dropTable(tableName);</span>
newDbMgr<span class="token punctuation">.</span>ddl<span class="token punctuation">.</span><span class="token function">createTable</span><span class="token punctuation">(</span>tableName<span class="token punctuation">,</span> <span class="token string">&#x27;messageid&#x27;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//true == auto manage primary key</span>
newDbMgr<span class="token punctuation">.</span>ddl<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span>tableName<span class="token punctuation">,</span> <span class="token string">&#x27;subjectid&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;text.subject&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
newDbMgr<span class="token punctuation">.</span>ddl<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span>tableName<span class="token punctuation">,</span> <span class="token string">&#x27;timeid&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;time&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
newDbMgr<span class="token punctuation">.</span>ddl<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span>tableName<span class="token punctuation">,</span> <span class="token string">&#x27;usernameid&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;user.name&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//Insert some data</span>
newDbMgr<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>tableName<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  message<span class="token operator">:</span> <span class="token punctuation">{</span>
    time<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    text<span class="token operator">:</span> <span class="token punctuation">{</span>
      fault<span class="token operator">:</span> Faker<span class="token punctuation">.</span>Lorem<span class="token punctuation">.</span><span class="token function">words</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      subject<span class="token operator">:</span> Faker<span class="token punctuation">.</span>Lorem<span class="token punctuation">.</span><span class="token function">sentence</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      description<span class="token operator">:</span> Faker<span class="token punctuation">.</span>Lorem<span class="token punctuation">.</span><span class="token function">paragraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    user<span class="token operator">:</span> Faker<span class="token punctuation">.</span>Helpers<span class="token punctuation">.</span><span class="token function">createCard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
newDbMgr<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>tableName<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  message<span class="token operator">:</span> <span class="token punctuation">{</span>
    time<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    text<span class="token operator">:</span> <span class="token punctuation">{</span>
      fault<span class="token operator">:</span> Faker<span class="token punctuation">.</span>Lorem<span class="token punctuation">.</span><span class="token function">words</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      subject<span class="token operator">:</span> Faker<span class="token punctuation">.</span>Lorem<span class="token punctuation">.</span><span class="token function">sentence</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      description<span class="token operator">:</span> Faker<span class="token punctuation">.</span>Lorem<span class="token punctuation">.</span><span class="token function">paragraph</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    user<span class="token operator">:</span> Faker<span class="token punctuation">.</span>Helpers<span class="token punctuation">.</span><span class="token function">createCard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//Query the data</span>
<span class="token keyword">var</span> results <span class="token operator">=</span> newDbMgr<span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&#x27;message&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span>tableName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">where</span><span class="token punctuation">(</span><span class="token string">&#x27;user.name&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;=&#x27;</span><span class="token punctuation">,</span> <span class="token string">&#x27;Bob&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div><p>To make it happen, some work needed to be done. First, you need a database connection. I never liked the implementation of “versioning” the database in WebSQL—but conceptually, it is the same mystery bag of disappointments in iDb; so the first step is to abstract and encapsulate the mechanism for opening a database connection and handling the version control events.</p><div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> initDb <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">var</span> name<span class="token punctuation">;</span>
 <span class="token comment">//Store the last used db name, db version and db connect promise in the closure</span>
 <span class="token keyword">var</span> version<span class="token punctuation">,</span> db<span class="token punctuation">,</span> connectPromise<span class="token punctuation">;</span>
 <span class="token keyword">var</span> reInit <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

 <span class="token comment">//The actual connect method to be used in order to establish a connection and/or trigger versioning</span>
 <span class="token keyword">var</span> <span class="token function-variable function">connect</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">dbName<span class="token punctuation">,</span> dbVersion<span class="token punctuation">,</span> dbOnUpgrade</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//Only create a new promise if connecting to a different db name or version; otherwise, the last issued promise is still good.</span>
  reInit <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">!</span>connectPromise <span class="token operator">||</span> dbName <span class="token operator">!==</span> name <span class="token operator">||</span> dbVersion <span class="token operator">!==</span> version<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>reInit<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">//Create a new promise from scratch</span>
   <span class="token keyword">var</span> deferred <span class="token operator">=</span> <span class="token constant">Q</span><span class="token punctuation">.</span><span class="token function">defer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">//Cache our state data in the outer closure</span>
   connectPromise <span class="token operator">=</span> deferred<span class="token punctuation">.</span>promise<span class="token punctuation">;</span>
   version <span class="token operator">=</span> dbVersion <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">;</span>
   name <span class="token operator">=</span> dbName<span class="token punctuation">;</span>
   dbOnUpgrade <span class="token operator">=</span> dbOnUpgrade <span class="token operator">||</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

   <span class="token comment">//Create the connection request. This is an async operation, which the promise will resolve.</span>
   <span class="token keyword">var</span> request <span class="token operator">=</span> window<span class="token punctuation">.</span>indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> version<span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">//Optionally do something when the request is completed (with or without error)</span>
   request<span class="token punctuation">.</span><span class="token function-variable function">oncomplete</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token punctuation">}</span>

   <span class="token comment">//Someone or something has explicitly aborted the request</span>
            request<span class="token punctuation">.</span><span class="token function-variable function">onabort</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                window<span class="token punctuation">.</span>console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#x27;Connection attempt to &#x27;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">&#x27; was aborted. Closing db connection now.&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

   <span class="token comment">//Connection has timed out</span>
            request<span class="token punctuation">.</span><span class="token function-variable function">ontimeout</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    window<span class="token punctuation">.</span>console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#x27;Connection attempt to &#x27;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">&#x27; timed out. Closing db connection now.&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

   <span class="token comment">//Another process has a lock on the database</span>
   request<span class="token punctuation">.</span><span class="token function-variable function">onblocked</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//Resolve the promise with rejection</span>
    deferred<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Database error: &quot;</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>errorCode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span>console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#x27;Connection attempt to &#x27;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">&#x27; was blocked by another process. Is the db open in another window/tab? Did you forget to close your connection to the db before attempting to version it? Closing db connection now.&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>

   <span class="token comment">//An error occurred at any time during the lifecycle of the request.</span>
   request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//Resolve the promise with rejection</span>
    deferred<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;Database error: &quot;</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>errorCode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span>console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#x27;Connection to &#x27;</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">&#x27; failed with error: &#x27;</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>errorCode <span class="token operator">+</span> <span class="token string">&#x27;. Closing db connection now.&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>

   <span class="token comment">//Versioning happens before success (promise is not yet resolved, but we have a handle on the db instance)</span>
   request<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>

    <span class="token function">dbOnUpgrade</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>

   <span class="token comment">//Request has succeeded; versioning may or may not have happened; connection to the database is established</span>
   request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    db <span class="token operator">=</span> request<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
    <span class="token comment">//Resolve the promise with success and the db instance</span>
    deferred<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">//Return either the new promise or the existing</span>
  <span class="token keyword">return</span> connectPromise<span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span>

 <span class="token comment">//More code to follow</span>
 <span class="token operator">...</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div><p>Hopefully the commentary in the code is sufficient to communicate its meaning. In essence, I’m leveraging Q’s deferred promise wrapper against the resolution of the iDb request’s async callbacks. Of course, if indexedDb simply implemented its many cascading callbacks as promises, this post might not exist.</p><p>Once the connection wrapper is defined, I can encapsulate some of the DDL operations into this new API.</p><div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">//private implementation method</span>
<span class="token keyword">var</span> <span class="token function-variable function">createTableImpl</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">dbWrapper<span class="token punctuation">,</span> db<span class="token punctuation">,</span> tableName<span class="token punctuation">,</span> tablePkColumnName<span class="token punctuation">,</span> autoIncrement</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//The call to createObjectStore is synchronous--the table is immediately returned</span>
  <span class="token keyword">var</span> table <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span>tableName<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    keyPath<span class="token operator">:</span> tablePkColumnName<span class="token punctuation">,</span>
    autoIncrement<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token operator">!==</span> autoIncrement<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//Cache the table instance for future reference</span>
  dbWrapper<span class="token punctuation">.</span>schema<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tableName<span class="token punctuation">,</span> table<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> table<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//public method. DDL operations can only happen as part of the versioning event.</span>
<span class="token comment">//Add the call to create the table to a schema scripts collection which the IndexedDb versioner will iterate.</span>
<span class="token keyword">var</span> <span class="token function-variable function">createTable</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">dbWrapper<span class="token punctuation">,</span> tableName<span class="token punctuation">,</span> tablePkColumnName<span class="token punctuation">,</span> autoIncrement</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//Create a new promise</span>
  <span class="token keyword">var</span> deferred <span class="token operator">=</span> <span class="token constant">Q</span><span class="token punctuation">.</span><span class="token function">defer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//Push this method into the scripts collection</span>
  schemaScripts<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">//Create the table</span>
      <span class="token keyword">var</span> objectStore <span class="token operator">=</span> <span class="token function">createTableImpl</span><span class="token punctuation">(</span>dbWrapper<span class="token punctuation">,</span> db<span class="token punctuation">,</span> tableName<span class="token punctuation">,</span> tablePkColumnName<span class="token punctuation">,</span> autoIncrement<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//Resolve the promise successful with the table</span>
      deferred<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>objectStore<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> e<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//Resolve the promise failed</span>
      deferred<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#x27;Could not create a new table&#x27;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> dbWrapper<span class="token punctuation">.</span>schemaschemaschemaschema\<span class="token punctuation">[</span>tableNametableNametableNametableName\<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> deferred<span class="token punctuation">.</span>promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div><p>If you return to my dream API above, you’ll notice that I placed the DDL operations first. Because this implementation uses promises, the order of operations is extraordinarily flexible. I could just as easily position the calls to DDL operations after a long list of calls to DML operations, and the Q promise layer would just make it work. This is in stark contrast to the iDb event model which is highly dependent upon the execution of functions being in the right place at the right time. Promises allow me, as a developer, to think less about the coordination of sequencing to/from other APIs and more about the order I want my own code to execute.</p><p>At any rate, the above is just enough to create some indexedDb tables. Next, the core of indexedDb: <a href="http://grammarist.com/usage/indexes-indices/">indexes</a>.</p><div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">//Private implementation method</span>
<span class="token keyword">var</span> <span class="token function-variable function">createIndexImpl</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">dbWrapper<span class="token punctuation">,</span> tableName<span class="token punctuation">,</span> columnName<span class="token punctuation">,</span> indexName<span class="token punctuation">,</span> isUnique</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//No need to wait on transaction, we have (or should have) the table in memory</span>
  <span class="token keyword">var</span> table <span class="token operator">=</span> dbWrapper<span class="token punctuation">.</span>schemaschemaschemaschema\<span class="token punctuation">[</span>tableNametableNametableNametableName\<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">//Create the new index and return it immediately (happens synchronously)</span>
  <span class="token comment">//It would be nice to cache the index on the cached table instance, but that table instance is actually an indexedDb object and I don&#x27;t want to mutate--nor do I want to refactor anything at the moment. So eat the cost of fetching a handle on indexes later. Told-you-so&#x27;s expected.</span>
  <span class="token keyword">return</span> table<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span>columnName<span class="token punctuation">,</span> indexName <span class="token operator">||</span> columnName <span class="token operator">+</span> <span class="token string">&#x27;Idx&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    unique<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token operator">!==</span> isUnique<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//public method. DDL operations can only happen as part of the versioning event.</span>
<span class="token comment">//Add the call to create the index to a schema scripts collection which the IndexedDb versioner will iterate.</span>
<span class="token keyword">var</span> <span class="token function-variable function">createIndex</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">dbWrapper<span class="token punctuation">,</span> tableName<span class="token punctuation">,</span> columnName<span class="token punctuation">,</span> indexName<span class="token punctuation">,</span> isUnique</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//Create a new promise</span>
  <span class="token keyword">var</span> deferred <span class="token operator">=</span> <span class="token constant">Q</span><span class="token punctuation">.</span><span class="token function">defer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//Push this method into the scripts collection</span>
  schemaScripts<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> index <span class="token operator">=</span> <span class="token function">createIndexImpl</span><span class="token punctuation">(</span>dbWrapper<span class="token punctuation">,</span> tableName<span class="token punctuation">,</span> columnName<span class="token punctuation">,</span> indexName<span class="token punctuation">,</span> isUnique<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//Resolve the promise successful with the new index</span>
      deferred<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> e<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">//Fail the promise</span>
      deferred<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#x27;Could not create a new index&#x27;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> dbWrapper<span class="token punctuation">.</span>schemaschemaschemaschema\<span class="token punctuation">[</span>tableNametableNametableNametableName\<span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> deferred<span class="token punctuation">.</span>promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div><p>Very much like the createTable method before it, the createIndex method hooks into the schema scripts collection and executes on the db versioning event. Unlike WebSQL or SQLite, IndexedDb is designed to be a non-necessarily-relational <em>object</em> store. So it stores <em>objects</em>. Objects can be primitive values, arrays or complex Object instances with deeply nested, non-relational tree structures. Indexes are levied against the property names of the values you want to be indexed.</p><div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  str<span class="token operator">:</span> <span class="token string">&#x27;&#x27;</span><span class="token punctuation">,</span>
  num<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  arr<span class="token operator">:</span> \<span class="token punctuation">[</span>\<span class="token punctuation">]</span><span class="token punctuation">,</span>
  obj1<span class="token operator">:</span> <span class="token punctuation">{</span>
    str1<span class="token operator">:</span> <span class="token string">&#x27;&#x27;</span><span class="token punctuation">,</span>
    obj2<span class="token operator">:</span> <span class="token punctuation">{</span>
      str2<span class="token operator">:</span> <span class="token string">&#x27;&#x27;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div><p>So an index on “str2” is as simple as defining an index on “obj1.obj2.str2”. This took me quite a bit of trial and error, so I think it’s worth highlighting how the pathing to an index works.</p><p>Finally (for the purpose of this post), you need a way to insert data into the store.</p><div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token comment">//Private implementation method, doesn&#x27;t yet conform to standard \*Impl paradigm. It&#x27;s ok; I&#x27;m ok; you&#x27;re ok.</span>
<span class="token keyword">var</span> <span class="token function-variable function">insertImpl</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">tableName<span class="token punctuation">,</span> records</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//Promise to insert the data</span>
  <span class="token keyword">var</span> deferred <span class="token operator">=</span> <span class="token constant">Q</span><span class="token punctuation">.</span><span class="token function">defer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">//Get a new transaction on the table. This is an insert, so &#x27;readwrite&#x27; is implicitly understood by the caller.</span>
    <span class="token keyword">var</span> transaction <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span>\<span class="token punctuation">[</span>tableNametableNametableNametableName\<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&#x27;readwrite&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//Get the object store from the transaction (gods forbid we fetched it from our own handle on the object store...and how the hell does this thing manage concurrency?!)</span>
    <span class="token keyword">var</span> objectStore <span class="token operator">=</span> transaction<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>tableName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//Insert the new records</span>
    n$<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>records<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">rec</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      objectStore<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rec<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//Resolve the promise</span>
    deferred<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> e<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//Fail the promise</span>
    deferred<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#x27;Could not insert records&#x27;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//Return the promise</span>
  <span class="token keyword">return</span> deferred<span class="token punctuation">.</span>promise<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//Public insert method</span>
<span class="token keyword">var</span> <span class="token function-variable function">insert</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">tableName<span class="token punctuation">,</span> records</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> <span class="token function-variable function">ret</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">insertImpl</span><span class="token punctuation">(</span>tableName<span class="token punctuation">,</span> records<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token comment">//If we have a db instance or if the initial connection promise is resolved (succeeded), then it is safe to insert immediately</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>db <span class="token operator">||</span> connectPromise<span class="token punctuation">.</span><span class="token function">isResolved</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">ret</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">//else wait for the connection promise to resolve and then do the insert (this seems to be the normal use case)</span>
    connectPromise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">//Nothing worth returning at this time</span>
  <span class="token comment">//return ret.promise;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre></div><p>I still have to put the finishing touches on some more of this API. Transactions become a bigger deal as you begin to write more complicated queries, and indexes (and their cursors) play a much, much larger role than I have touched upon here; but I think that this provides one alternative to the problem of working with indexedDb that is simple.</p><p>This whole abstraction needs to be lazy, and there is another round of refactoring I need to do to move it into a pure functional style; but I think it is more readable and approachable this way.</p><p>I hope to have JsPerf tests and an expanded API for my next post. Until then, I’ll leave you with the full example code:</p><div class="gatsby-highlight" data-language="js"><pre class="language-js"><code class="language-js"><span class="token keyword">var</span> initDb <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> name<span class="token punctuation">,</span>
    version<span class="token punctuation">,</span>
    db<span class="token punctuation">,</span>
    connectPromise<span class="token punctuation">,</span>
    upgradeIsRequired <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> schemaScripts <span class="token operator">=</span> \<span class="token punctuation">[</span>\<span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> <span class="token function-variable function">connect</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">dbName<span class="token punctuation">,</span> dbVersion<span class="token punctuation">,</span> dbOnUpgrade</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    upgradeIsRequired <span class="token operator">=</span> <span class="token operator">!</span>connectPromise <span class="token operator">||</span> dbName <span class="token operator">!==</span> name <span class="token operator">||</span> dbVersion <span class="token operator">!==</span> version<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>upgradeIsRequired<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> deferred <span class="token operator">=</span> <span class="token constant">Q</span><span class="token punctuation">.</span><span class="token function">defer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      connectPromise <span class="token operator">=</span> deferred<span class="token punctuation">.</span>promise<span class="token punctuation">;</span>

      version <span class="token operator">=</span> dbVersion <span class="token operator">||</span> <span class="token number">1</span><span class="token punctuation">;</span>
      name <span class="token operator">=</span> dbName<span class="token punctuation">;</span>
      dbOnUpgrade <span class="token operator">=</span> dbOnUpgrade <span class="token operator">||</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

      <span class="token keyword">var</span> request <span class="token operator">=</span> window<span class="token punctuation">.</span>indexedDB<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> version<span class="token punctuation">)</span><span class="token punctuation">;</span>

      request<span class="token punctuation">.</span><span class="token function-variable function">onblocked</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">&#x27;A new version of this page is ready. Please reload!&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>

      request<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        deferred<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#x27;Database error: &#x27;</span> <span class="token operator">+</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>errorCode<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>db<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      request<span class="token punctuation">.</span><span class="token function-variable function">onsuccess</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        db <span class="token operator">=</span> request<span class="token punctuation">.</span>result<span class="token punctuation">;</span>
        deferred<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
      request<span class="token punctuation">.</span><span class="token function-variable function">onupgradeneeded</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        db <span class="token operator">=</span> event<span class="token punctuation">.</span>target<span class="token punctuation">.</span>result<span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>schemaScripts<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          n$<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>schemaScripts<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">script</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">//debugger;</span>
            <span class="token function">script</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">dbOnUpgrade</span><span class="token punctuation">(</span>db<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> connectPromise<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> <span class="token function-variable function">disconnect</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>connectPromise<span class="token punctuation">.</span><span class="token function">isFulfilled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      db<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>db<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      connectPromise<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">(</span>db<span class="token punctuation">.</span>close<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> <span class="token function-variable function">createTableImpl</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">dbWrapper<span class="token punctuation">,</span> db<span class="token punctuation">,</span> tableName<span class="token punctuation">,</span> tablePkColumnName<span class="token punctuation">,</span> autoIncrement</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> table <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">createObjectStore</span><span class="token punctuation">(</span>tableName<span class="token punctuation">,</span> <span class="token punctuation">{</span>
      keyPath<span class="token operator">:</span> tablePkColumnName<span class="token punctuation">,</span>
      autoIncrement<span class="token operator">:</span> <span class="token boolean">false</span> <span class="token operator">!==</span> autoIncrement<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    dbWrapper<span class="token punctuation">.</span>schema<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>tableName<span class="token punctuation">,</span> table<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> table<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> <span class="token function-variable function">createTable</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">dbWrapper<span class="token punctuation">,</span> tableName<span class="token punctuation">,</span> tablePkColumnName<span class="token punctuation">,</span> autoIncrement</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> deferred <span class="token operator">=</span> <span class="token constant">Q</span><span class="token punctuation">.</span><span class="token function">defer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    schemaScripts<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">db</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> objectStore <span class="token operator">=</span> <span class="token function">createTableImpl</span><span class="token punctuation">(</span>
          dbWrapper<span class="token punctuation">,</span>
          db<span class="token punctuation">,</span>
          tableName<span class="token punctuation">,</span>
          tablePkColumnName<span class="token punctuation">,</span>
          autoIncrement<span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        deferred<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>objectStore<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> e<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span>
        deferred<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#x27;Could not create a new table&#x27;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> dbWrapper<span class="token punctuation">.</span>schemaschemaschemaschema\<span class="token punctuation">[</span>tableNametableNametableNametableName\<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> deferred<span class="token punctuation">.</span>promise<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> <span class="token function-variable function">createIndexImpl</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">dbWrapper<span class="token punctuation">,</span> tableName<span class="token punctuation">,</span> columnName<span class="token punctuation">,</span> indexName<span class="token punctuation">,</span> isUnique</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> table <span class="token operator">=</span> dbWrapper<span class="token punctuation">.</span>schemaschemaschemaschema\<span class="token punctuation">[</span>tableNametableNametableNametableName\<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> table<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span>columnName<span class="token punctuation">,</span> indexName <span class="token operator">||</span> columnName <span class="token operator">+</span> <span class="token string">&#x27;Idx&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      unique<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token operator">!==</span> isUnique<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> <span class="token function-variable function">createIndex</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">dbWrapper<span class="token punctuation">,</span> tableName<span class="token punctuation">,</span> columnName<span class="token punctuation">,</span> indexName<span class="token punctuation">,</span> isUnique</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> deferred <span class="token operator">=</span> <span class="token constant">Q</span><span class="token punctuation">.</span><span class="token function">defer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    schemaScripts<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> index <span class="token operator">=</span> <span class="token function">createIndexImpl</span><span class="token punctuation">(</span>dbWrapper<span class="token punctuation">,</span> tableName<span class="token punctuation">,</span> columnName<span class="token punctuation">,</span> indexName<span class="token punctuation">,</span> isUnique<span class="token punctuation">)</span><span class="token punctuation">;</span>
        deferred<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> e<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span>
        deferred<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#x27;Could not create a new index&#x27;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> dbWrapper<span class="token punctuation">.</span>schemaschemaschemaschema\<span class="token punctuation">[</span>tableNametableNametableNametableName\<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> deferred<span class="token punctuation">.</span>promise<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> <span class="token function-variable function">insertImpl</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">tableName<span class="token punctuation">,</span> records</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> deferred <span class="token operator">=</span> <span class="token constant">Q</span><span class="token punctuation">.</span><span class="token function">defer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> transaction <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token function">transaction</span><span class="token punctuation">(</span>\<span class="token punctuation">[</span>tableNametableNametableNametableName\<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&#x27;readwrite&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token keyword">var</span> objectStore <span class="token operator">=</span> transaction<span class="token punctuation">.</span><span class="token function">objectStore</span><span class="token punctuation">(</span>tableName<span class="token punctuation">)</span><span class="token punctuation">;</span>
      n$<span class="token punctuation">.</span><span class="token function">each</span><span class="token punctuation">(</span>records<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">rec</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        objectStore<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>rec<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      deferred<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> e<span class="token punctuation">.</span>stack<span class="token punctuation">)</span><span class="token punctuation">;</span>
      deferred<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#x27;Could not insert records&#x27;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> deferred<span class="token punctuation">.</span>promise<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">var</span> <span class="token function-variable function">insert</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">tableName<span class="token punctuation">,</span> records</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> <span class="token function-variable function">ret</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">insertImpl</span><span class="token punctuation">(</span>tableName<span class="token punctuation">,</span> records<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>db <span class="token operator">||</span> connectPromise<span class="token punctuation">.</span><span class="token function">isResolved</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">ret</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      connectPromise<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//return ret.promise;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> ret <span class="token operator">=</span> n$<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ret<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&#x27;connect&#x27;</span><span class="token punctuation">,</span> connect<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ret<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&#x27;disconnect&#x27;</span><span class="token punctuation">,</span> disconnect<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ret<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&#x27;schema&#x27;</span><span class="token punctuation">,</span> n$<span class="token punctuation">.</span><span class="token function">object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ret<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&#x27;ddl&#x27;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token function-variable function">createTable</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">tableName<span class="token punctuation">,</span> tablePkColumnName<span class="token punctuation">,</span> autoIncrement</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        args<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">createTable</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">dropTable</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">tableName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        args<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">createTable</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function-variable function">createIndex</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">tableName<span class="token punctuation">,</span> columnName<span class="token punctuation">,</span> indexName<span class="token punctuation">,</span> isUnique</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">var</span> args <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        args<span class="token punctuation">.</span><span class="token function">unshift</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token function">createIndex</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ret<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">&#x27;insert&#x27;</span><span class="token punctuation">,</span> insert<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> ret<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre></div></div><div id="comment_div"><div id="commento"></div></div><div class="addPaddTopBottom"><style data-emotion-css="1lbctsv">.css-1lbctsv{margin:0px;padding:0px;width:auto;display:grid;grid-template-rows:auto;-webkit-column-gap:24px;column-gap:24px;grid-template-columns:calc(50% - 8px) calc(50% - 8px);}.css-1lbctsv .previousBtn{cursor:pointer;-moz-box-align:center;-moz-box-direction:normal;-moz-box-orient:horizontal;margin:0px;padding:0px;position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;place-self:stretch;border-radius:3px;border:1px solid rgb(230,236,241);-webkit-transition:border 200ms ease 0s;transition:border 200ms ease 0s;box-shadow:rgba(116,129,141,0.1) 0px 3px 8px 0px;-webkit-text-decoration:none;text-decoration:none;background-color:#001933;color:#fff;}.css-1lbctsv .nextBtn{cursor:pointer;-moz-box-align:center;-moz-box-direction:normal;-moz-box-orient:horizontal;margin:0px;padding:0px;position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;place-self:stretch;border-radius:3px;border:1px solid rgb(230,236,241);-webkit-transition:border 200ms ease 0s;transition:border 200ms ease 0s;box-shadow:rgba(116,129,141,0.1) 0px 3px 8px 0px;-webkit-text-decoration:none;text-decoration:none;background-color:#001933;color:#fff;}.css-1lbctsv .nextBtn:hover,.css-1lbctsv .previousBtn:hover{-webkit-text-decoration:none;text-decoration:none;border:1px solid #1ed3c6;}.css-1lbctsv .nextBtn:hover .rightArrow,.css-1lbctsv .previousBtn:hover .leftArrow{color:#1ed3c6;}.css-1lbctsv .leftArrow{display:block;margin:0px;color:rgb(157,170,182);-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:24px;-webkit-transition:color 200ms ease 0s;transition:color 200ms ease 0s;padding:16px;padding-right:16px;}.css-1lbctsv .rightArrow{-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:24px;-webkit-transition:color 200ms ease 0s;transition:color 200ms ease 0s;padding:16px;padding-left:16px;display:block;margin:0px;color:rgb(157,170,182);}.css-1lbctsv .nextPreviousTitle{display:block;margin:0px;padding:0px;-webkit-transition:color 200ms ease 0s;transition:color 200ms ease 0s;}.css-1lbctsv .nextPreviousTitle span{font-size:16px;line-height:1.5;font-weight:500;}@media (max-width:767px){.css-1lbctsv{display:block;padding:0 15px;}.css-1lbctsv .previousBtn{margin-bottom:20px;}}</style><div class="css-1lbctsv ec9eivm0"><a title="From JsDoc to Github Pages in 27 easy steps (aka API Documentation Considered Evil)?" class="previousBtn" href="/2013/api-documentation-considered-evil"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-alt-left" class="svg-inline--fa fa-arrow-alt-left fa-w-14 fa-lg " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="padding-left:5px"><path fill="currentColor" d="M448 208v96c0 13.3-10.7 24-24 24H224v103.8c0 21.4-25.8 32.1-41 17L7 273c-9.4-9.4-9.4-24.6 0-34L183 63.3c15.1-15.1 41-4.4 41 17V184h200c13.3 0 24 10.7 24 24z"></path></svg><div class="preRightWrapper"><div class="smallContent"><span>суббота, 06.07.2013 г.</span></div><div class="nextPreviousTitle"><span>From JsDoc to Github Pages in 27 easy steps (aka API Documentation Considered Evil)?</span></div></div></a><a title="Your Hyperbole is Too Large" class="nextBtn" href="/2012/your-hyperbole-is-too-large"><div class="nextRightWrapper"><div class="smallContent"><span>суббота, 16.06.2012 г.</span></div><div class="nextPreviousTitle"><span>Your Hyperbole is Too Large</span></div></div><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="arrow-alt-right" class="svg-inline--fa fa-arrow-alt-right fa-w-14 fa-lg " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" style="padding-right:5px"><path fill="currentColor" d="M0 304v-96c0-13.3 10.7-24 24-24h200V80.2c0-21.4 25.8-32.1 41-17L441 239c9.4 9.4 9.4 24.6 0 34L265 448.7c-15.1 15.1-41 4.4-41-17V328H24c-13.3 0-24-10.7-24-24z"></path></svg></a></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/2013/a-promise-to-indexeddb";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-c8ad486913edc6f30661.js"],"app":["/app-e6a5d6e68faad991f6c2.js"],"component---cache-caches-gatsby-plugin-offline-app-shell-js":["/component---cache-caches-gatsby-plugin-offline-app-shell-js-fd4fb51a6fac1c18bdde.js"],"component---src-pages-404-tsx":["/component---src-pages-404-tsx-292933f1c88a5f954d62.js"],"component---src-templates-article-tsx":[],"component---src-templates-label-tsx":[],"component---src-templates-source-tsx":[],"component---src-templates-tag-tsx":[],"component---src-templates-визуализации-tsx":[]};/*]]>*/</script><script src="/polyfill-c8ad486913edc6f30661.js" nomodule=""></script><script src="/app-e6a5d6e68faad991f6c2.js" async=""></script><script src="/5cb6ece7-82975cb71936d667e479.js" async=""></script><script src="/ec1189df-52caf2ebf9f054842623.js" async=""></script><script src="/af13d906-bea834845607db013d0c.js" async=""></script><script src="/c943faba-8cfcfdbf099e99c933af.js" async=""></script><script src="/958b4c57-de047c1242e11b7f8058.js" async=""></script><script src="/a9a7754c-8f76031e99554fb9676e.js" async=""></script><script src="/framework-6eeb8ad043160a79d5e7.js" async=""></script><script src="/styles-31f023f48facb69035d3.js" async=""></script><script src="/webpack-runtime-4ac74d59a0ad025bf0f4.js" async=""></script></body></html>